# DVB-S2 Hardware

å¹³å°: Xilinx ZedBoard+AD9361 Zynq-7000 SoC

#### Block design:

![](./pictures/DVB_S2_TXRX_HW.png)

# RX Inner Receiver
å¯¦ç¾æ¨¡çµ„: Matched Filter and Symbol Timing Synchronizer

![](./pictures/rx_inner_recv.png)

## Matched Filter 
#### Interface:
![](./pictures/DVB_S2_MF_HW.png)

#### Architecture:
![](./pictures/DVB_S2_MF_HW_1.png)


SRRC åŒ¹é…æ¿¾æ³¢å™¨è¼¸å…¥è¨Šè™Ÿç‚ºr_B[n] 32 ä½å…ƒï¼Œåˆ†ç‚ºå¯¦éƒ¨(æˆ–åŒç›¸ in-phase, I)å’Œè™›éƒ¨(æ­£äº¤ç›¸ quadrature, Q)è¨Šè™Ÿå„ 16 ä½å…ƒï¼Œæ‰€ä»¥åŒ¹é…æ¿¾æ³¢å™¨æœƒåˆ†æˆ Iå’Œ Q è·¯åšé‹ç®—ã€‚I è·¯ç‚ºr_B[ğ‘›]çš„æœ€é«˜ä½å…ƒ(most significant bit, MSB)çš„å‰16 ä½å…ƒçš„ä½ç½®(ç¡¬é«”èªè¨€ä¸­ä»¥ r_B[31:16] è¡¨ç¤ºç‚ºå– r_B è¨Šè™Ÿå¾å·¦å´é–‹å§‹æ•¸çš„ 16 å€‹ä½ç½®)ï¼ŒQ è·¯ç‚ºr_B[ğ‘›]çš„æœ€ä½ä½å…ƒ(least significant bit, LSB) çš„ 16 ä½å…ƒçš„ä½ç½®(ç¡¬é«”èªè¨€ä¸­ä»¥ r_B[15:0] è¡¨ç¤ºç‚ºå– r_B è¨Šè™Ÿå¾å³å´é–‹å§‹æ•¸çš„ 16 å€‹ä½ç½®)ã€‚SRRC ä¿‚æ•¸è¨­è¨ˆç‚º 15 ä½å…ƒï¼Œç›¸ä¹˜å¾Œçš„å€¼è¨­è¨ˆç‚º 31 ä½å…ƒï¼Œæœ€å¾Œä¸€ç´šè¼¸å‡ºå€¼ç”± 31 ä½å…ƒé‡åŒ–ç‚º 16 ä½å…ƒä¹‹r_M[ğ‘›]çš„Iã€Q è¨Šè™Ÿã€‚


## Symbol Timing Synchronizer
#### Interface:
![](./pictures/DVB_S2_STS_HW.png)

#### Architecture:
åŒ¹é…æ¿¾æ³¢å™¨è¼¸å‡ºç«¯åŠ ä¸Šæ™‚é–“éŒ¯èª¤æª¢æ¸¬å™¨(Timing error detector, TED)ï¼Œåˆ©ç”¨åŒ¹é…æ¿¾æ³¢å™¨çš„è¼¸å‡ºå’Œæœ¬åœ°åƒè€ƒè¨Šè™Ÿä¹‹é–“ä¼°è¨ˆå‡ºä¸€å€‹æ™‚é–“åç§»å€¼ï¼Œæ­¤åç§»å€¼æ¥è‘—è¼¸å…¥åˆ°è¿´è·¯æ¿¾æ³¢å™¨(Loop filter)å¾—åˆ°å°å–æ¨£æ™‚é–“å’Œæ­¥ä¼å¾®èª¿çš„å€¼ï¼Œä¸¦é€é Farrowå…§æ’å™¨(Interpolator)é‡æ–°å–æ¨£å¾—åˆ°æœ€ä½³è§€æ¸¬é»ï¼Œé”åˆ°ç¬¦ç¢¼åŒæ­¥ä¹‹ç›®æ¨™ï¼Œæ¶æ§‹å¦‚ä¸‹åœ–ã€‚

![](./pictures/DVB_S2_STS_HW_1.png)


### Gardner Timing Error Detector (Gardner TED)
ä½¿ç”¨Gardner æå‡ºçš„æ¼”ç®—æ³•ï¼Œåˆ©ç”¨æ¥æ”¶åˆ°çš„æ¨£æœ¬ä¼°è¨ˆæ™‚é–“ç›¸ä½åå·®ã€‚
åŸç†æ˜¯ç”±æ–¼ç†æƒ³ç¬¦ç¢¼æ™‚é–“ç›¸ä½æ˜¯åœ¨çœ¼åœ–é–‹æœ€å¤§ä½ç½®ï¼Œå³å…¶åŠŸç‡æœ€å¤§ä½ç½®ï¼Œå¾è¨ˆç®—é€£çºŒæ™‚é–“ç¬¦ç¢¼å€é–“å…§çš„å¹³å‡åŠŸç‡$J(\tau)$ä½œç‚ºè§€å¯Ÿï¼Œå°‡å…¶å¾®åˆ†å¾Œå³ç‚ºé›¶é»ï¼Œå³æ˜¯ç†æƒ³ç¬¦ç¢¼æ™‚é–“ç›¸ä½ï¼Œç”¨ä¾†åˆ¤æ–·ç•¶ä¸‹çš„æ™‚é–“ç›¸ä½ç›¸å°æ–¼ç†æƒ³æ™‚é–“ç›¸ä½æ˜¯æå‰(Early)æˆ–æ˜¯è½å¾Œ(Late)ã€‚
è€Œå°$J(\tau)$åšå¾®åˆ†ä¹‹å…¬å¼ï¼Œå¯¦éš›ä¸Šç°¡åŒ–å¾Œï¼Œå³ç‚ºé‡æ–°å–æ¨£çš„è§€æ¸¬å€¼å’Œå®ƒçš„å¾®åˆ†å€¼å–å…±è»›è¤‡æ•¸ï¼Œåšç›¸ä¹˜å¾Œå–å¯¦éƒ¨ã€‚

$J(\tau)=\frac{1}{N}*\sum_{k=0}^{N-1}\mid r_M(k\cdot T_{sym}+\tau)\mid^2$

$e_D[k]=\frac{dJ(\tau)}{d\tau}=Re\{r_M(k\cdot T_{sym}+\tau)\cdot (\frac{dr_M(k\cdot T_{sym}+\tau)}{d\Delta\tau})^*\}=Re\{r_{sym}[k]\}\cdot Re\{r_{sym}^[k]\}+Im\{r_{sym}[k]\}\cdot Im\{r_{sym}^[k]\}$



### Loop Filter
è¿´è·¯æ¿¾æ³¢å™¨(Loop filter)çš„è¼¸å…¥å³æ˜¯æ™‚é–“èª¤å·®è¨Šè™Ÿï¼Œç›®çš„æ˜¯ç”¨ä¾†ç©©å®šæ™‚é–“ç›¸ä½çš„æ ¡æ­£ç‡ï¼Œä½¿å…§æ’å™¨é”åˆ°æœ€ä½³å–æ¨£ã€‚
ç”¨æ¥æ”¶åˆ°é›¢æ•£çš„è§€æ¸¬å€¼$ğ‘’_ğ·[ğ‘˜]$ï¼Œé€éè¿´è·¯æ¿¾æ³¢å™¨åšå‹•æ…‹èª¿æ•´æ™‚é–“ç›¸ä½ï¼Œç•¶åƒæ•¸èª¿æ•´é©ç•¶æ™‚å³æœƒé–å®šæ™‚é–“ç›¸ä½ã€‚

è¿´è·¯æ¿¾æ³¢å™¨æœ‰å…©å€‹é‡è¦çš„åƒæ•¸ K1 å’Œ K2ã€‚K1 åŠŸèƒ½ç‚ºè¿½è¹¤æ™‚é–“ç›¸ä½èª¤å·®ï¼Œæ ¹æ“šæ™‚é–“ç›¸ä½èª¤å·®çš„å¤§å°èª¿æ•´å…¶ç›¸ä½ã€‚K2 ç‚ºè¿½è¹¤é »ç‡èª¤å·®ã€‚

$e_p[k]=K1\times e_D[k]$

$e_i[0]=4$

$e_i[k]=e-i[k-1]+K2\times e_D[k]$

$e_F[k]=e_i[k]+e_p[k]$

ç°¡å–®ä¾†èªªï¼Œç•¶$ğ‘’_ğ·[ğ‘˜] > 0$ç‚ºæ™‚é–“ç›¸ä½æå‰(Early)ï¼Œ$e_F[ğ‘˜]$å°±æœƒåŠ å¤§æ­¥ä¼ï¼Œè€Œç•¶$ğ‘’_ğ·[ğ‘˜] < 0$ç‚ºæ™‚é–“ç›¸ä½è½å¾Œ(Late)ï¼Œ$e_F[ğ‘˜]$å°±æœƒæ¸›å°æ­¥ä¼ã€‚

#### Architecture:

![](./pictures/LF_HW.png)


### Farrow Interpolator
Farrow å…§æ’å™¨æ˜¯ä¸€ç¨®å°‡è¨Šè™Ÿå’Œè„ˆè¡éŸ¿æ‡‰åš convolution çš„æœ‰é™è„ˆè¡éŸ¿æ‡‰(Finite Impulse Response, FIR)æ¿¾æ³¢å™¨ã€‚å…¶ä¿‚æ•¸ï¼Œç¡¬é«”è¨­è¨ˆä½¿ç”¨ 13 ä½å…ƒçš„å›ºå®šé»æ•¸ã€‚

![](./pictures/FI_coe.png)

æ¨å°å®Œä¹‹Farrowå…§æ’å™¨æ¨¡å‹ï¼Œè€Œæ ¹æ“š Gardner æ¼”ç®—æ³•é‚„éœ€è¦å…§æ’å™¨çš„å¾®åˆ†å€¼æ¨¡å‹å¦‚ä¸‹:

![](./pictures/FI_formula.png)



### Interpolation Controller
å…§æ’æ§åˆ¶å™¨è² è²¬å‘ŠçŸ¥å…§æ’å™¨å–æ¨£çš„æ™‚é–“é»($T_{ğ‘ ğ‘¦ğ‘š}[ğ‘˜]$)ï¼Œå…¶å–æ¨£æ™‚é–“é»$T_{ğ‘ ğ‘¦ğ‘š}[ğ‘˜]$ç”±è¿´è·¯æ¿¾æ³¢å™¨çš„è¼¸å‡º$e_F[ğ‘˜]$èª¿æ•´ã€‚å–æ¨£æ™‚é–“é»$T_{ğ‘ ğ‘¦ğ‘š}$åˆå§‹å€¼ç‚ºé›¶ï¼Œç•¶æ™‚é–“ k æ•¸åˆ° 4 çš„å€æ•¸æœƒåŠ ä¸Š$e_F[ğ‘˜]$èª¿æ•´ï¼Œä¸¦å‘ŠçŸ¥å…§æ’å™¨å–æ¨£ã€‚

$T_{ğ‘ ğ‘¦ğ‘š}[0]=0$

$T_{ğ‘ ğ‘¦ğ‘š}[ğ‘˜]=T_{ğ‘ ğ‘¦ğ‘š}[ğ‘˜-1]+e_F[k]$


